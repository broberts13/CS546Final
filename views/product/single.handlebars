<div class="main">
      <h1 class="Ptitle">Everything has beauty, but not everyone sees it.</h1>
       <h2 class=" Ptitle1">Cosmetic Review Hub</h2>
  <div class="shop_top">   
    <div class="container">
      <div class="row">     
        <div class="col-md-9 single_left">
          <div class="single_image">
           
            {{!-- start product picture --}}
              <img class="float-left" src="{{product.productPicture}}" alt="product" width="300" height="400">
					    </div>
          <!-- end product_slider -->
         {{!-- start product description  --}}
          <div class="single_right">
            <h3>{{product.productName}}</h3>
       
            <p class="m_10"><strong>Brand:</strong>{{product.brand}}</p>
            
            <p class="m_10"><strong>Category</strong><br>{{product.category}}</p>
            

    
		<button id="like" type="submit" class="box-btn" data-productid="{{product._id}}"><span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span></button>
            <br>				    	

            <input type="hidden" id="userID" value="{{flag}}">
            <input type="hidden" id="revlikeID" value="{{flag1}}">
            <input type ="hidden"  id="curUser" value="{{user._id}}">
            <div class="btn_form">
              <form>
                <label for="like"> Like</label>
              </form>
            </div>
            <ul class="add-to-links">
              <li><i class="fa fa-heart red-color " ></i><a
                  id="btn-whishlist"
                  href="/users/wishlist/{{product._id}}"
                > Add to wishlist</a></li>
            </ul>
            <p id="wishsucc" class="success"></p>
            <p id="wisherr" class="err"></p>
             <br>
              <p><strong>Links to buy this product:</strong></p>
              {{#each product.productLinks}}
              
              <a href="{{this}}">Buy here</a>
              <br>
              {{/each}}
          </div>

        
          <div class="clear"> </div>
        </div>
        <div class="col-md-3">
          <div class="box-info-product">
            <p class="price2">${{product.price}}</p>
            <ul class="prosuct-qty">
              <li><label><strong>Likes: {{product.likes.length}}</strong><span class="float-right"></span></label><br>
              <br></li>
              <li>
                <label><strong>Average rating: {{product.overallRating}} </strong><span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i class="rating"><strong
                        >{{this.rating}} </strong></i>
                      <i class="text-warning fa fa-star"></i></span></label>
              </li> 
              
            </ul>
            <form>
              <button type="submit" name="Submit" class="exclusive" formaction="{{product.productLinks.[0]}}">
                <span>Let's Buy</span>
              </button>
            </form>
          </div>
        </div>
      </div>
      {{!-- end of product description --}}
      
      {{!--start add review container --}}
        <div class="container">
            <div class="row">
              <div>
                <br>
                <br>
            <h3>Add Review</h3>
            <table width="100%" border="0">
              <div class="col-md-9 col-md-offset-0">
                <tr></tr>
                <tr><td width="77%">
                <div class="">
                  <form id="addreview" class="form-horizontal" action="/products/review/{{product._id}}" method="post">
                  <fieldset>
            
                    <!-- Name input-->
                    <div class="form-group">
                      <label class="col-md-3 control-label" for="title">Review Title</label>
                      <div class="col-md-9">
                        <input id="title" name="title" type="text" placeholder="Title" class="form-control">
                      </div>
                    </div>
            
                    
                    <!-- Message body -->
                    <div class="form-group">
                      <label for="reviewBody" class="col-md-3 control-label" for="review">Your Review</label>
                      <div class="col-md-9">
                       
                        <textarea class="form-control" id="reviewBody" name="reviewBody" placeholder="Please enter your review here..." rows="5"></textarea>
                      </div>
                       
                    </div>


                    <!-- Rating -->
                    <div class="form-group">
                      <label class="col-md-3 control-label" for="review">Your rating</label>
                      
                      <div class="col-md-9">
                        <p id = "input-success" class= "float-right success"></p>
                        <p id = "input-error" class= "float-right err"></p>
                        <input id="rating" name=rating value="0" type="number" class="rating" min=0 max=5 step=1 data-size="xs" >
                       
                      </div>
                    </div>
                    
            </td>
            <td align="center" valign="top" width="23%">
                    <!-- Form actions -->
                    <div class="form-group">
                      <div class="col-md-12 text-center">
                        <button name="btn-addreview" type="submit" class="btn btn-primary btn-md">Submit</button>
                        <button type="reset" class="btn btn-default btn-md">Clear</button>
                      </div>
                    </div>
                  </fieldset>
                  </form>
                </div>
            </div>
            </td>
            </tr>
            </table>
        </div>
        </div>
      {{!-- end add review container --}}
<br>  
<br>

  
      <div class="desc">
        <div class="container">
          <div id="reviews" class="review-section">
            {{!-- start review progress-bar-container --}}  
            <div class="d-flex align-items-center justify-content-between mb-4">
              <h4 class="m-0">{{product.reviews.length}} Reviews</h4>
              <select
                class="custom-select custom-select-sm border-0 shadow-sm ml-2 select2-hidden-accessible"
                data-select2-id="1"
                tabindex="-1"
                aria-hidden="true"
              >
                <option data-select2-id="3">Most Liked</option>
              </select>
              <span
                class="select2 select2-container select2-container--default"
                dir="ltr"
                data-select2-id="2"
                style="width: 188px;"
              >
                <span class="selection">
                  <span
                    class="select2-selection select2-selection--single"
                    role="combobox"
                    aria-haspopup="true"
                    aria-expanded="false"
                    tabindex="0"
                    aria-labelledby="select2-qd66-container"
                  >
                    <span
                      class="select2-selection__rendered"
                      id="select2-qd66-container"
                      role="textbox"
                      aria-readonly="true"
                      title="Overall rating"
                    ><strong>Average rating: {{product.overallRating}}    <span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i
                        class="text-warning fa fa-star"
                      ></i></span>
                    <span class="float-right"><i class="rating"><strong
                        >{{this.rating}} </strong></i>
                      <i class="text-warning fa fa-star"></i></span></strong></span>
                    <span
                      class="select2-selection__arrow"
                      role="presentation"
                    ><b role="presentation"></b></span>
                  </span>
                </span>
                <span class="dropdown-wrapper" aria-hidden="true"></span>
              </span>
            </div>
            <div class="row">
              <div class="col-md-6">
                <table class="stars-counters">
                  <tbody>
                    <tr class="">
                      <td>
                        <span>
                          <button
                            class="fit-button fit-button-color-blue fit-button-fill-ghost fit-button-size-medium stars-filter"
                          >5 Stars</button>
                        </span>
                      </td>
                      <td class="progress-bar-container">
                        <div
                          class="fit-progressbar fit-progressbar-bar star-progress-bar"
                        >
                          <div class="fit-progressbar-background">
                            <span
                              class="progress-fill"
                              style="width: {{status.bar5}}%;"
                            ></span>
                          </div>
                        </div>
                      </td>
                      <td class="star-num">({{status.a}})</td>
                    </tr>
                    <tr class="">
                      <td>
                        <span>
                          <button
                            class="fit-button fit-button-color-blue fit-button-fill-ghost fit-button-size-medium stars-filter"
                          >4 Stars</button>
                        </span>
                      </td>
                      <td class="progress-bar-container">
                        <div
                          class="fit-progressbar fit-progressbar-bar star-progress-bar"
                        >
                          <div class="fit-progressbar-background">
                            <span
                              class="progress-fill"
                              style="width: {{status.bar4}}%;"
                            ></span>
                          </div>
                        </div>
                      </td>
                      <td class="star-num">({{status.b}})</td>
                    </tr>
                    <tr class="">
                      <td>
                        <span>
                          <button
                            class="fit-button fit-button-color-blue fit-button-fill-ghost fit-button-size-medium stars-filter"
                          >3 Stars</button>
                        </span>
                      </td>
                      <td class="progress-bar-container">
                        <div
                          class="fit-progressbar fit-progressbar-bar star-progress-bar"
                        >
                          <div class="fit-progressbar-background">
                            <span
                              class="progress-fill"
                              style="width: {{status.bar3}}%;"
                            ></span>
                          </div>
                        </div>
                      </td>
                      <td class="star-num">({{status.c}})</td>
                    </tr>
                    <tr class="">
                      <td>
                        <span>
                          <button
                            class="fit-button fit-button-color-blue fit-button-fill-ghost fit-button-size-medium stars-filter"
                          >2 Stars</button>
                        </span>
                      </td>
                      <td class="progress-bar-container">
                        <div
                          class="fit-progressbar fit-progressbar-bar star-progress-bar"
                        >
                          <div class="fit-progressbar-background">
                            <span
                              class="progress-fill"
                              style="width: {{status.bar2}}%;"
                            ></span>
                          </div>
                        </div>
                      </td>
                      <td class="star-num">({{status.d}})</td>
                    </tr>
                    <tr class="">
                      <td>
                        <span>
                          <button
                            class="fit-button fit-button-color-blue fit-button-fill-ghost fit-button-size-medium stars-filter"
                          >1 Stars</button>
                        </span>
                      </td>
                      <td class="progress-bar-container">
                        <div
                          class="fit-progressbar fit-progressbar-bar star-progress-bar"
                        >
                          <div class="fit-progressbar-background">
                            <span
                              class="progress-fill"
                              style="width: {{status.bar1}}%;"
                            ></span>
                          </div>
                        </div>
                      </td>
                      <td class="star-num">({{status.e}})</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-md-6">
              </div>
            </div>
          </div>
          {{!-- end review progress-bar-container --}}
          {{!-- start review lists --}}
          <div class="review-list">
          {{#each product.reviews}}
          
         <div class="card">
	        <div class="card-body review-blog">
	            <div class="row">
        	      <div class="col-md-2">
        	        <img src={{this.user.userImage}} class="img img-rounded img-fluid" alt="Reviewing User"/>
        	        <p class="text-secondary text-center">{{this.date}}</p>
        	    </div>
        	    <div class="col-md-10">
        	        <p>
        	            <a class="float-left review-username" href="#"><strong>{{this.user.userName}}</strong></a>
                      <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                      <span class="float-right"><i class="text-warning fa fa-star"></i></span>
        	            <span class="float-right"><i class="text-warning fa fa-star"></i></span>
        	            <span class="float-right" ><i class="rating"><strong>{{this.rating}} </strong></i> <i class="text-warning fa fa-star"></i></span>              

        	   </p>
        	       <div class="clearfix"></div>
                    <p class="review-id" data-userid="{{user.userName}}" data-reviewid="{{this._id}}">{{this.title}}</p>
                    <p>{{this.reviewBody}}</p>
        	        <p>
                      {{!-- Added class review-reply as an identifier for the review like button --}}
        	            <a class="float-right btn btn-outline-primary ml-2 review-reply"> <i class="fa fa-reply"></i> Comment </a>
                      {{!-- Added class review-like as an identifier for the review like button --}}
        	            <a id = "revlike"  class="float-right btn text-white btn-danger review-like" data-selected="{{this.islike}}" > <i class="fa fa-heart"></i> <span>Like</span></a>
        	      {{!-- id = "revlike" --}}
                
                 </p>
                 <br>
                 <br>
                 <br>
                 <br>
                 <p id ="rev-err" class="float-right reverr"></p>
                  <p id ="rev-suc" class="float-right revsuc"></p>
                  
        	    </div>
              
              

              <div class="reviews-members-footer">
                                    <div class="total-like" href="#"><i class="glyphicon glyphicon-thumbs-up"></i> {{this.likes.length}}</div>
                                    <div class="total-like" href="#"><i class="glyphicon glyphicon-comment"></i> {{this.Comments.length}}</div> 
                                                  </div>
	        </div>
            <!-- Start of Comments -->
           <div class="comment-space">
            <br>
            {{#each this.Comments}}
	        	<div class="card card-inner">
            	    <div class="card-body">
            	        <div class="row">
                    	    <div class="col-md-2">
                    	        <img  src="{{this.user.userImage}}" class="img img-rounded img-fluid" alt="Commenting User" />
                    	        <p  class="text-secondary text-center">{{this.date}}</p>
                    	    </div>
                    	    <div class="col-md-10">
                    	        <p><a href="#"><strong id="userName">{{this.user.userName}}</strong></a></p>
                    	        <p>{{this.commentBody}}</p>
                    	        <p>
                
                                  </p>
                    	    </div>
            	        </div>
                         
            	    </div>
              
	            </div>
                 {{/each}}
<!-- Start of Comment Dialog box-->
<div class="card card-inner" id="commentDialog" style="display:none">
          <div class="card-body">
                            <div class="row">
                                <div class="col-md-2">
                                  <!-- Todo Add server side script to show photo -->
                                    <img id="userImg" src="https://image.ibb.co/jw55Ex/def_face.jpg" class="img img-rounded img-fluid" alt="ProfilPic"/>
                                    <p id="commentTime" class="text-secondary text-center post-time">Time</p>
                                </div>
                                <div class="col-md-10 comment-area">
                                  <!-- Todo Add server side script to show name of the logged in person -->
                                    <p><a href="#"><strong id="userName">{{user.userName}}</strong></a></p>
                                    <p>
                                        <textarea autofocus id="cmntbody" class="review-txt-area" rows="4" style="width:100%" placeholder="Write a comment"></textarea>
                                    </p>
                                    <p class="commenterr" id="comment-error" ></p>

                                    <p>
                                        <a class="float-right btn text-white btn-primary add-comment"> <span>ADD</span></a>
                                  </p>
                                </div>
                            </div>
                              
            </div>
                    
  </div>

  <!-- End of Commnt Dialog Box-->




            </div>
            <!-- End of Comments -->   
	         </div>
	        </div>
          
          {{/each}}
          {{!-- end of review list --}}
          </div>
        </div>
      </div>
  </div>
</div>
{{!-- javascript code, ajax code, for review like, product like,comments --}}



<script>
//   Adding product Like
	$(function($) {
     $(document).on('click', '.box-btn', function(event) {
    
    var selected ="false";
   //Checking if the product is liked
	  if ( $(this).find('.glyphicon').hasClass('red')){
		       selected = true;
    }		  
	  //Adding productID to the URL
    var productIDUrl = "/products/likes/"+ $(this).data("productid");	
		$.ajax({
		type: "POST",
		url: productIDUrl,
		data: {},
		success: function (data) {
    //Unlike the product if already liked   
		if(selected  ==  true){
           $("#like").find('.glyphicon').addClass('glyphicon-heart-empty');
           $("#like").find('.glyphicon').removeClass('red glyphicon-heart');

    }
    else{
      //Liking the product
      $("#like").find('.glyphicon').removeClass('glyphicon-heart-empty');
      $("#like").find('.glyphicon').addClass('red glyphicon-heart');
    }
			
		},
		error: function (xhr, textStatus, error) {
       $("#wisherr").text("Login to Add Product Like");
		},
		});

  });
  


 // <!-- Adding Review Like -->
  $(document).on("click", ".review-like" , function() {

      var ID = $(this).closest(".review-blog").find(".review-id");
      var errbtn = $(this).closest(".review-blog").find("#rev-err");
      var likeBtn = $(this);     
      var revid= ID.data("reviewid");
      var likereviewUrl = "/products/reviews/likes/"+revid;	
          
        $.ajax({
            type: 'POST',
            url: likereviewUrl,
            data: {},
            success: function (data) {
                
                  likeBtn.find('span').text("Liked");
                  likeBtn.removeClass("btn-danger").addClass("btn-dark");
                  
            },
              error: function (jqXhr, textStatus, errorMessage) {
              errbtn.text("Login to Like Reviews");
            }
        });

        });
  //<!-- End of Review Likes -->

 // <!-- Showing Comments Dialogue-->
  $(document).on("click", ".review-reply" , function() {
     
    var errbtn = $(this).closest(".review-blog").find("#rev-err");  
    if($("#curUser").val()){    
    var commentdialogue = $('#commentDialog').detach();
    $(this).closest(".review-blog").find(".comment-space").append(commentdialogue);
    $("#commentDialog").show();  
    $("#commentTime").html("Now");
    $("#userName").html("{{user.userName}}");
    $("#userImg").attr('src','{{user.userImage}}');
       $("#cmntbody").focus();
    }
    else{
        errbtn.text("Login to Comment on Reviews");
    }     
  });
 // <!-- End of Comments Dialogue-->
  
  //<!-- Start of Add commnts -->
   $(document).on("click", ".add-comment" , function() {
      var sucbtn = $(this).closest(".review-blog").find("#rev-suc");  
      var ID = $(this).closest(".review-blog").find(".review-id");
      var revid= ID.data("reviewid");
      var commentUrl = "/products/reviews/comment/"+revid;	
      comment = $(this).closest(".comment-area").find(".review-txt-area");
      
      commentVal =comment.val();
     
      comment.val("");
        if (commentVal.trim()) {
          
      $.ajax({
       type: 'POST',
       url: commentUrl,
       data: { commentBody: commentVal },
       success: function (data) {        
         
        //$(this).closest(".review-blog").find(".comment-space").append("<div class='card card-inner'><div class='card-body'><div class='row'><div class='col-md-2'><img src='https://image.ibb.co/jw55Ex/def_face.jpg' class='img img-rounded img-fluid'/><p class='text-secondary text-center'>15 Minutes Ago</p></div><div class='col-md-10'><p><a href='https://maniruzzaman-akash.blogspot.com/p/contact.html'><strong>Maniruzzaman Akash</strong></a></p><p>"+commentVal+"</p><p><a class='float-right btn btn-outline-primary ml-2'>  <i class='fa fa-reply'></i> Reply</a><a class='float-right btn text-white btn-danger review-like'><i class='fa fa-heart'></i> <span>Like</span></a></p></div></div></div></div>");
        $("#commentDialog").hide();  
        sucbtn.text("Comment Added Sucessfully");
        window.setTimeout(function(){location.reload()},1800)
      },
        error: function (jqXhr, textStatus, errorMessage) {
          $("#comment-error").text(errorMessage);
      }
    });
     $("#commentDialog").hide();   
    }
    else{
      $("#comment-error").text("Please Enter valid comment");
    }   
         
          
  });
   <!-- End of Add commnts -->


//productIDLikes
if($("#userID").val() == "true"){
  $("#like").find('.glyphicon').removeClass('glyphicon-heart-empty');
  $("#like").find('.glyphicon').addClass('red glyphicon-heart ');
}
//reviewIDlikes


//Start of checking for liked review on page load 
$(".review-like").each(function(){
  if($(this).data("selected") == true){
    $(this).find('span').text("Liked");
    $(this).removeClass("btn-danger").addClass("btn-dark");
  }
 
  });
//End of liked review on page load

 

}); 

</script>
<script type="text/javascript">
        $(document).ready(function() {
            $(".dropdown img.flag").addClass("flagvisibility");

            $(".dropdown dt a").click(function() {
                $(".dropdown dd ul").toggle();
            });
                        
            $(".dropdown dd ul li a").click(function() {
                var text = $(this).html();
                $(".dropdown dt a span").html(text);
                $(".dropdown dd ul").hide();
                $("#result").html("Selected value is: " + getSelectedValue("sample"));
            });
                        
            function getSelectedValue(id) {
                return $("#" + id).find("dt a span.value").html();
            }

            $(document).bind('click', function(e) {
                var $clicked = $(e.target);
                if (! $clicked.parents().hasClass("dropdown"))
                    $(".dropdown dd ul").hide();
            });


            $("#flagSwitcher").click(function() {
                $(".dropdown img.flag").toggleClass("flagvisibility");
            });
        });
   </script>

<script src="/public/js/wishlist.js"></script>
<script src="/public/js/reviews.js"></script>

<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<script src="//code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="/public/js/reviewstructure.js"></script> 
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>



